<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta charset="utf-8">

    <title>Confidence Intervals and Bootstrapping &ndash; Gastón Amengual</title>

    <!-- PWA -->
    <link rel="manifest" href="https://gastonamengual.github.io/theme/site.webmanifest">
    <meta name="theme-color" content="#6A1A6A">
    <link rel="apple-touch-icon" sizes="180x180" href="https://gastonamengual.github.io/theme/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://gastonamengual.github.io/theme/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://gastonamengual.github.io/theme/favicon/favicon-16x16.png">
    <link rel="shortcut icon" type="image/png" href="https://gastonamengual.github.io/theme/favicon/favicon-32x32.png">

    <!-- Social -->
    <meta property="article:author" content="Gastón Amengual" />
    <meta property="article:section" content="Statistics" />
    <meta property="article:published_time" content="2021-01-21" />

    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Confidence Intervals and Bootstrapping"/>
    <meta property="og:description" content="Explanation of Confidence Intervals, Bootstrapping, and comparison."/>
    <meta property="og:site_name" content="Gastón Amengual" />
    <meta property="og:url" content="https://gastonamengual.github.io/confidence-intervals-and-bootstrapping.html"/>


    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Spartan:100,200,300,400,500,600,700,800,900">
    <link rel="stylesheet" type="text/css" href="https://gastonamengual.github.io/theme/css/w3.css">
    <link rel="stylesheet" type="text/css" href="https://gastonamengual.github.io/theme/css/style.css">
    <link rel="stylesheet" type="text/css" href="https://gastonamengual.github.io/theme/css/gruvbox.css">
    <link href='fonts/fonts.css' rel='stylesheet'>
  </head>

  <body>
    <div class="w3-row w3-card w3-white">
      <header id="header">
        <img src="https://gastonamengual.github.io/theme/gaston_amengual.svg" id="header-logo">
        <nav id="header-menu">
          <ul>
            <li class="header-li"><a href="https://gastonamengual.github.io/">About</a></li>
            <li class="header-li"><a href="https://gastonamengual.github.io/pages/portfolio.html">PORTFOLIO</a></li>
            <li class="header-li"><a href="/categories.html">Articles</a></li>
          </ul>
        </nav>
      </header>
    </div>



    <br><br>

    <article>
      <header class="w3-container col-main" style="display: flex; flex-direction: column;">
        <h1>Confidence Intervals and Bootstrapping</h1>
        <span style="margin-top: 1rem;"></span><a style="font-size: 1.6rem;" href="https://gastonamengual.github.io/category/statistics.html" title="All articles in category Statistics">Statistics</a></span>
        <span style="margin-top: 1rem; margin-bottom: 1rem;"><time datetime="2021-01-21T00:00:00+01:00">Thu 21 January 2021</time></span>

         
      </header>



      <div class="col-main w3-container">
        <section id="content">
          <p><strong>Notebook written by Gastón Amengual.</strong></p>
<hr>

<h1>Confidence Intervals</h1>
<p>A confidence interval is a type of estimate computed from the statistics of the observed data, and were introduced by Jerzy Neyman in 1937. This proposes a range of plausible values for an unknown parameter, like the population mean. The interval has an associated confidence level that the true parameter is in the proposed range. </p>
<p>The confidence level represents the frequency of possible confidence intervals that contain the true value of the unknown population parameter. If confidence intervals are constructed using a given confidence level from an infinite number of independent sample statistics, the proportion of those intervals that contain the true value of the parameter will be equal to the confidence level. </p>
<p>If an experiment in which a confidence interval is calculated is repeated infinite times, a certain percentage of the experiments will capture the population parameter in their confidence intervals. Most of the times, frequentists choose an interval that captures the population parameter 95% of the time, which be used in the following examples.</p>
<h2>Interpretation</h2>
<ul>
<li>
<p>The confidence interval can be expressed in terms of repeated samples: Were this procedure to be repeated on numerous samples, the fraction of calculated confidence intervals (which would differ for each sample) that encompass the true population parameter would tend toward 95%.</p>
</li>
<li>
<p>The confidence interval can be expressed in terms of a single sample: There is a 90% probability that the calculated confidence interval from some future experiment encompasses the true value of the population parameter." It is crucial to note that this probability statement is about the confidence interval, not about the population parameter. This considers the probability associated with a confidence interval from a pre-experiment point of view, and it is known, before the actual experiment is carried out, that the single interval calculated has a particular chance of covering the true but unknown value.</p>
</li>
<li>
<p>The explanation of a confidence interval can amount to something like: "The confidence interval represents values for the population parameter for which the difference between the parameter and the observed estimate is not statistically significant at the 10% level".</p>
</li>
</ul>
<h2>Calculation</h2>
<p>It is assumed that the samples are drawn from an (approximately) normal distribution.</p>
<ol>
<li>Identify the sample mean <span class="math">\(\bar{x}\)</span>.</li>
</ol>
<p><strong>Population standard deviation <span class="math">\(\sigma\)</span> is known</strong></p>
<ol>
<li><span class="math">\(z^* = - \Phi^1 \left( \dfrac{\alpha}{2} \right)\)</span>, where <span class="math">\(\Phi\)</span> is the CDF of the standard normal distribution (used as critical value), and the confidence level <span class="math">\(C = 100(1 - \alpha)%\)</span>.</li>
</ol>
<p><span class="math">\(C \rightarrow Z^*\)</span></p>
<p><span class="math">\(99\% \rightarrow 2.576\)</span></p>
<p><span class="math">\(98\% \rightarrow 2.326\)</span></p>
<p><span class="math">\(95\% \rightarrow 1.96\)</span></p>
<p><span class="math">\(90\% \rightarrow 1.645\)</span></p>
<ol>
<li>The confidence interval is calculated as</li>
</ol>
<div class="math">$$\left( \bar{x} - z^*\dfrac{\sigma}{\sqrt{n}} \; , \; \bar{x} + z^*\dfrac{\sigma}{\sqrt{n}} \right)$$</div>
<p><strong>Population standard deviation <span class="math">\(\sigma\)</span> is unknown and estimated by the sample standard deviation <span class="math">\(s\)</span>.</strong></p>
<ol>
<li>
<p>If the population standard deviation is unknown t-values and the sample size is below 30, then the Student's t distribution is used as the critical value. This value is dependent on the confidence level (C) for the test and degrees of freedom. The degrees of freedom are found by subtracting one from the number of observations, n − 1. The critical value is found from the t-distribution table. </p>
</li>
<li>
<p>The confidence interval is calculated as</p>
</li>
</ol>
<div class="math">$$\left( \bar{x} - t^*\dfrac{s}{\sqrt{n}} \; , \; \bar{x} + t^*\dfrac{s}{\sqrt{n}} \right)$$</div>
<h2>Cup Filling Example</h2>
<p>A machine fills cups with a liquid, and is supposed to be adjusted so that the content of the cups is <span class="math">\(250 g\)</span> of liquid. As the machine cannot fill every cup with exactly 250 g, the content added to individual cups shows some variation, and is considered a random variable <span class="math">\(X\)</span>. This variation is assumed to be normally distributed around the desired average of <span class="math">\(250 g\)</span>, with a standard deviation <span class="math">\(\sigma = 2.5 g\)</span>. To determine if the machine is adequately calibrated, a sample of <span class="math">\(n = 25\)</span> cups of liquid is chosen at random and the cups are weighed. The resulting measured masses of liquid are <span class="math">\(X_1, \dotsc, X_{25}\)</span>, a random sample from <span class="math">\(X\)</span>.</p>
<div class="highlight"><pre><span></span><code><span class="n">mean</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">std</span> <span class="o">=</span> <span class="mf">2.5</span>
<span class="n">sample_size</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">z_score</span> <span class="o">=</span> <span class="mf">1.96</span> <span class="c1"># for 95% confidence</span>
<span class="n">num_samples</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">contains_population_mean</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">confidence_intervals</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span>

    <span class="n">sample_mean</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">sample_mean</span> <span class="o">-</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="p">(</span><span class="n">std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_size</span><span class="p">))</span>
    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">sample_mean</span> <span class="o">+</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="p">(</span><span class="n">std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_size</span><span class="p">))</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">mean</span> <span class="o">&gt;</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mean</span> <span class="o">&lt;</span> <span class="n">upper_bound</span><span class="p">):</span>
        <span class="n">contains_population_mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">contains_population_mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">confidence_intervals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">])</span>

<span class="n">confidence_level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">contains_population_mean</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
</code></pre></div>


<p><img alt="image alt text" src="https://gastonamengual.github.io/images/confidence_intervals_and_bootstrapping_1.png"></p>
<h1>Bootstrapping</h1>
<p>On the example analyzed previously, both population mean and standard deviation were known. However, in real life that hardly happens, and it is only a single sample that can be worked with, and it is the best and only information possessed about the population.</p>
<p><strong>Resampling</strong> is a non-parametric method of statistical inference that consists of drawing repeated samples from the original data sample. </p>
<p><strong>Bootstrapping</strong> is a resampling method for estimating quantities about a population by averaging estimates from multiple data samples, and can be used to estimate the confidence intervals. Bootstrapping is done with sampling with replacement, that is, the samples are constructed by drawing observations from data sample one at a time and returning them to the sample after they have been chosen, allowing an observation to be included in a sample more than once. </p>
<p>Although other statistical techniques used to determine confidence intervals assume a known population mean or standard deviation, bootstrapping does not require anything other than a statistically significant sample, i.e. large enough (otherwise may derive in lack of validity to estimate the parameter).</p>
<p>The <strong>steps of bootstrapping</strong> are:</p>
<ol>
<li>
<p>Repeat <span class="math">\(n\)</span> times:</p>
<ol>
<li>
<p>Draw a sample with replacement of size equal to the original data set size.</p>
</li>
<li>
<p>Calculate and save the statistic on the sample.</p>
</li>
</ol>
</li>
<li>
<p>Calculate the statistic of the calculated sample statistics.</p>
</li>
</ol>
<p>To sum up, bootstrapping does resampling with replacement maintaining data structure but reshuffling values, extrapolating to the population. It is useful for estimating statistical parameters where data are non-normal, have unknown statistical properties, or lack a standard calculation. Nonetheless, some parameters like variance and standard deviation ah inherently biased (underestimated) in bootstrapping, as extreme values on the edges tend to be rare to appear in bootstrap samples.</p>
<p>Let us continue the previous Cup Filling Example, now calculating the confidence interval with a Bootstrap Resample approach.</p>
<div class="highlight"><pre><span></span><code><span class="n">original_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">)</span>

<span class="n">sample_mean_distribution</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
    <span class="n">bootstrap_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">original_sample</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">original_sample</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sample_mean_distribution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bootstrap_sample</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">sample_mean_distribution</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample_mean_distribution</span><span class="p">)</span>
</code></pre></div>


<p>The <span class="math">\(95\%\)</span> confidence interval is constructed of the <span class="math">\(2.25\)</span> and <span class="math">\(97.5\)</span> percentiles.</p>
<div class="highlight"><pre><span></span><code><span class="n">bootstrap_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sample_mean_distribution</span><span class="p">)</span>
<span class="n">lower_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bootstrap_sorted</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">)</span>
<span class="n">upper_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">bootstrap_sorted</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">sample_mean_distribution</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sample_mean_distribution</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>


<p><img alt="image alt text" src="https://gastonamengual.github.io/images/confidence_intervals_and_bootstrapping_2.png"></p>
<p>As can be observed, this method shows similar results as those produced by the analytic calculation, and approximates very efficiently the population mean.</p>
<hr>

<h1>References</h1>
<p>https://www.wikiwand.com/en/Confidence_interval</p>
<p>https://machinelearningmastery.com/a-gentle-introduction-to-the-bootstrap-method/</p>
<p>https://www.thoughtco.com/example-of-bootstrapping-3126155</p>
<p>https://www.statisticshowto.com/resampling-techniques/</p>
<p>Resampling methods (bootstrapping) - Matthew E. Clapham - https://www.youtube.com/watch?v=gcPIyeqymOU </p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
        </section>

        <br><br>

        <footer>


        </footer>
      </div>
    </article>


    <footer id="footer">
      <div id="footer-copyright" class="w3-center w3-large w3-text-white w3-padding-48">
        <span>
          &copy;
          2021          Gastón Amengual
        </span>
      </div>
    </footer>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-6KC62F9717"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());
  gtag('config', "G-6KC62F9717");</script>    </body>
</html>