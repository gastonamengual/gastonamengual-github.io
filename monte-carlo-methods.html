<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta charset="utf-8">

    <title>Monte Carlo Methods &ndash; Gastón Amengual</title>

    <!-- PWA -->
    <link rel="manifest" href="https://gastonamengual.github.io/theme/site.webmanifest">
    <meta name="theme-color" content="#6A1A6A">
    <link rel="apple-touch-icon" sizes="180x180" href="https://gastonamengual.github.io/theme/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://gastonamengual.github.io/theme/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://gastonamengual.github.io/theme/favicon/favicon-16x16.png">
    <link rel="shortcut icon" type="image/png" href="https://gastonamengual.github.io/theme/favicon/favicon-32x32.png">

    <!-- Social -->
    <meta property="article:author" content="Gastón Amengual" />
    <meta property="article:section" content="Modeling and Simulation" />
    <meta property="article:published_time" content="2020-09-24" />

    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Monte Carlo Methods"/>
    <meta property="og:description" content="Includes three applications of the Monte Carlo Methods: Integration, Pi Approximation, and Custom Distribution Sampling."/>
    <meta property="og:site_name" content="Gastón Amengual" />
    <meta property="og:url" content="https://gastonamengual.github.io/monte-carlo-methods.html"/>


    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Spartan:100,200,300,400,500,600,700,800,900">
    <link rel="stylesheet" type="text/css" href="https://gastonamengual.github.io/theme/style.css">
    <link href='fonts/fonts.css' rel='stylesheet'>
  </head>

  <body>
    <div id="navbar">
        <a href="../index.html"><img src="https://gastonamengual.github.io/theme/gaston_amengual.svg" id="navbar-logo"></a>
        <nav id="navbar-menu">
          <ul>
            
              <li class="navbar-li"><a href="/index.html">Home</a></li>
              <li class="navbar-li"><a href="/pages/about.html">About</a></li>
              <li class="navbar-li"><a href="/pages/portfolio.html">Portfolio</a></li>
              <li class="navbar-li"><a href="/categories.html">Articles</a></li>
          </ul>
        </nav>
    </div>



    <br><br>

    <article class="article-article">
      <header class="col-main article-header">
        <h1>Monte Carlo Methods</h1>
        <a class="article-category" href="https://gastonamengual.github.io/category/modeling-and-simulation.html">Modeling and Simulation</a>
        <time class="article-date" datetime="2020-09-24T00:00:00-03:00">Thu 24 September 2020</time>
      </header>

      <div class="col-main">
        <section class="article-content">
          <p><strong>Notebook written by Gastón Amengual.</strong></p>
<hr>

<p>The Monte Carlo Methods are computational algorithms, numerical methods of solving mathematical problems by random sampling (or by the simulation of random variables). They rely on random number generation to solve deterministic problems.</p>
<p>The Law of Large Numbers states that as the number of identically distributed, randomly generated variables increases, their sample mean (average) approaches their theoretical mean, and that is the basis for Monte Carlo simulations and allows to build a stochastic model by the method of statistical trials.</p>
<p>Monte Carlo Methods or random sampling are used to run a simulation. For example, if it is sought to compute the time it will take to go from point A to point B, given some initial conditions, these conditions can be set at the start and the simulation can be run e.g. 1000 times to get an estimated time (the higher the number of runs or trials, the better the estimate).</p>
<p>Another application are simple integrals, which can be computed using the Riemann sum technique, a computationally expensive process in higher dimensions. Integration by Monte Carlo Methods can produce reasonably close approximations at a lower computational cost.</p>
<h1>Monte Carlo Integration</h1>
<p>Calculating the integral of some expressions analytically is easy if the expression is simple. In many cases, however, analytical approaches to integration are not feasible, as the expression is very complicated, possibly without a closed analytical integral, or it can be evaluated at various points but it is not possible to know the corresponding equation. In such situations, Monte Carlo methods allow to generate an approximation of the integral, represented by the <strong>basic Monte Carlo estimator</strong> equation.</p>
<p>The average value of a function is given by</p>
<p><span class="math">\(f_{avg} = \dfrac{1}{b-a} \int_a^b f(x) dx\)</span> </p>
<p>Consequently, </p>
<p><span class="math">\(\int_a^b f(x) dx = (b-a) f_{avg}\)</span></p>
<p><span class="math">\(\left \langle F^N \right \rangle = (b-a) \dfrac{1}{N} \sum_{i=0}^{N-1} f(X_i) \quad\)</span> where <span class="math">\(N\)</span> is the number of samples used in the approximation.</p>
<p><span class="math">\(\left \langle F^N \right \rangle = \bar{F}_N = E[F_N]\)</span></p>
<p><span class="math">\(X_i = a + U(b - a) \quad\)</span> where U is uniformly distributed between <span class="math">\(0\)</span> and <span class="math">\(1\)</span>.</p>
<p>The law of large numbers states that as <span class="math">\(N\)</span> approaches infinity, the Monte Carlo approximation converges (in probability) to the right answer:</p>
<p><span class="math">\(P(\lim_{N \rightarrow \infty} E[F_N] = F) = 1\)</span></p>
<p>simply by evaluating the expression a large number of times at randomly selected points in the input space and counting the proportion that are less than the integrand at that point. The larger the number of simulations we run, the better the approximation.</p>
<p>The formula used above works only for a uniform PDF. The more generic formula is:</p>
<p><span class="math">\(\left \langle F^N \right \rangle = \dfrac{1}{N} \sum_{i=0}^{N-1} \dfrac{f(X_i)}{\text{PDF}(X_i)} \quad\)</span> where <span class="math">\(N\)</span> is the number of samples used in the approximation.</p>
<p>Dividing <span class="math">\(f(x)\)</span> by <span class="math">\(PDF(x)\)</span> is necessary for non-constant PDFs . When samples aren't uniformly distributed, more samples are generated where the PDF is high and reversely, fewer samples are generated where the PDF is low. In a Monte Carlo integration though, the samples need to be uniformly distributed, in order not to be biased. Dividing <span class="math">\(f(x)\)</span> by <span class="math">\(PDF(x)\)</span> counterbalances this effect: when the PDF is high, dividing <span class="math">\(f(x)\)</span> by <span class="math">\(PDF(x)\)</span> will decrease the "weight" of these samples in the sum, compensating for the higher concentration of samples; when the PDF is low, fewer samples are generated, but dividing <span class="math">\(f(x)\)</span> by a low value increases the contribution of these samples.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">monte_carlo_estimator</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
    <span class="n">points</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
    <span class="n">average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">points</span><span class="p">)))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">average</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">f_of_x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s1">&#39;$\int_</span><span class="si">{1}</span><span class="s1">^</span><span class="si">{5}</span><span class="s1"> x^2 dx$&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The integral Monte Carlo Estimator value is </span><span class="si">{</span><span class="n">monte_carlo_estimator</span><span class="p">(</span><span class="n">f_of_x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">f_of_x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s1">&#39;$\int_</span><span class="si">{0}</span><span class="s1">^{2\pi} sin(x) dx$&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The integral Monte Carlo Estimator value is </span><span class="si">{</span><span class="n">monte_carlo_estimator</span><span class="p">(</span><span class="n">f_of_x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">f_of_x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="s1">&#39;$\int_</span><span class="si">{0}</span><span class="s1">^{\infty} \dfrac{e^{-x}}{1+ (x-1)^2}dx$&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The integral Monte Carlo Estimator value is </span><span class="si">{</span><span class="n">monte_carlo_estimator</span><span class="p">(</span><span class="n">f_of_x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>


<p><span class="math">\(\int_{1}^{5} x^2 dx\)</span></p>
<div class="highlight"><pre><span></span><code><span class="err">The integral Monte Carlo Estimator value is 38.9021</span>
</code></pre></div>


<p><span class="math">\(\int_{0}^{2\pi} sin(x) dx\)</span></p>
<div class="highlight"><pre><span></span><code><span class="err">The integral Monte Carlo Estimator value is -0.0966</span>
</code></pre></div>


<p><span class="math">\(\int_{0}^{\infty} \dfrac{e^{-x}}{1+ (x-1)^2}dx\)</span></p>
<div class="highlight"><pre><span></span><code><span class="err">The integral Monte Carlo Estimator value is 0.6933</span>
</code></pre></div>


<h2>Estimation of <span class="math">\(\pi\)</span></h2>
<ol>
<li>Generate random <span class="math">\((x, y)\)</span> points belonging to a square of area <span class="math">\(4 r^2\)</span> centered at <span class="math">\((h,k)\)</span>, where <span class="math">\(r\)</span> is the side length. </li>
<li>Calculate the points of the square that belong to a circle of ratio <span class="math">\(r\)</span> and area <span class="math">\(\pi r^2\)</span>, that is, <span class="math">\(\sqrt{(x-h)^2 + (y-k)^2} &lt;= r^2\)</span>.</li>
<li>Calculate the approximation of <span class="math">\(\pi\)</span> as four times the proportion <span class="math">\(p\)</span> of points inside the circle over the total number of points:</li>
</ol>
<div class="math">$$p = \dfrac{\text{circle area}}{\text{square area}}$$</div>
<div class="math">$$p = \dfrac{\pi r^2}{4 r^2} = \dfrac{\pi}{4}$$</div>
<div class="math">$$\pi = 4 p$$</div>
<div class="highlight"><pre><span></span><code><span class="n">num_points</span> <span class="o">=</span> <span class="mi">3000000</span>
<span class="n">r</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">square_x</span><span class="p">,</span> <span class="n">square_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_points</span><span class="p">))</span>
<span class="n">circle_x</span><span class="p">,</span> <span class="n">circle_y</span> <span class="o">=</span> <span class="n">square_x</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">square_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">square_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">],</span> <span class="n">square_y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">square_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">square_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">]</span>

<span class="n">pi</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">circle_x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">square_x</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">square_x</span><span class="p">,</span> <span class="n">square_y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">circle_x</span><span class="p">,</span> <span class="n">circle_y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
</code></pre></div>


<p><img alt="image alt text" src="https://gastonamengual.github.io/images/monte_carlo_methods_1.png"></p>
<h2>Custom Distribution Sampling</h2>
<p>Most distributions can be sampled from their analytic expressions. However, when working with the operation of multiple distributions, this analytic formula can be complex. Monte Carlo Methods allow to sample direct from each distribution, and apply the operations to those generated values to obtain the new custom distribution.</p>
<p>Let <span class="math">\(X \sim U(0,1) , \quad Y \sim Exp(0.5) , \quad Z \sim N(0,1) , \quad Q \sim B(2,5)\)</span>.</p>
<p>Let <span class="math">\(A = (X + Y + Z) \cdot Q\)</span>.</p>
<div class="highlight"><pre><span></span><code><span class="n">sample_size</span> <span class="o">=</span> <span class="mi">100000</span>
<span class="n">A_distribution</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span>  <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="n">Y</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">Z</span><span class="p">)</span> <span class="o">*</span> <span class="n">Q</span>

<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>


<p><img alt="image alt text" src="https://gastonamengual.github.io/images/monte_carlo_methods_2.png"></p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
        </section>
      </div>

      <br><br>

    </article>


    <footer>
        <p>
          &copy;
          2021          Gastón Amengual
        </p>
    </footer>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-6KC62F9717"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());
  gtag('config', "G-6KC62F9717");</script>  </body>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    tex2jax: { inlineMath: [["$","$"],["\\(","\\)"]] },
    "HTML-CSS": {
      linebreaks: { automatic: true, width: "container" }
    }
    });
  </script>
</html>